<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AppFitness - Registro (Paso 2)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script defer src="js/app.js"></script>
</head>

<body>
  <!-- NavBar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="index.html">Golds Gym</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto"></ul>
      </div>
    </div>
  </nav>

  <div class="container py-4" style="max-width: 720px;">
    <h1>Gold Gym</h1>
    <h2>Registrar Usuario — Paso 2</h2>
    <p class="text-muted" id="resume"></p>

    <div class="row g-3 mt-2">
      <div class="col-md-6">
        <label class="form-label">Altura (cm)</label>
        <input id="reg_height" type="number" class="form-control" placeholder="175" min="100" max="250" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Peso (kg)</label>
        <input id="reg_weight" type="number" class="form-control" placeholder="70" min="30" max="300" step="0.1"
          required>
      </div>

      <div class="col-md-6">
        <label class="form-label">Experiencia</label>
        <select id="reg_experience" class="form-select" required>
          <option value="" selected disabled>Elegir…</option>
          <option value="Beginner">Beginner</option>
          <option value="Intermediate">Intermediate</option>
          <option value="Advanced">Advanced</option>
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label">Objetivo</label>
        <select id="reg_goal" class="form-select" required>
          <option value="" selected disabled>Elegir…</option>
          <option value="LoseWeight">LoseWeight</option>
          <option value="GainWeight">GainWeight</option>
          <option value="Maintain">Maintain</option>
        </select>
      </div>
    </div>

    <div class="d-flex gap-2 mt-4">
      <button id="btn_register2" class="btn btn-outline-primary">Guardar</button>
      <button type="button" class="btn btn-outline-danger" id="btn_clear2">Borrar</button>
    </div>

    <p id="register_msg2" class="text-danger mt-2"></p>
  </div>

  <script>
    // Mostrar un mini resumen del paso 1 (si existe)
    (function preload() {
      const part1 = sessionStorage.getItem('reg_part1');
      if (!part1) {
        // si entró directo a /register2.html sin pasar por el 1
        window.location.href = "register.html";
        return;
      }
      const u = JSON.parse(part1);
      const txt = `${u.name ?? ""} ${u.surname ?? ""} — ${u.email ?? ""}`;
      document.getElementById('resume').textContent = `Vas a crear la cuenta para: ${txt}`;
    })();

    // Limpiar
    document.getElementById('btn_clear2').addEventListener('click', () => {
      ['reg_height', 'reg_weight', 'reg_experience', 'reg_goal'].forEach(id => document.getElementById(id).value = "");
    });

    // Finalizar registro → combina paso1 + paso2 y llama a la API
    document.getElementById('btn_register2').addEventListener('click', async () => {
      const part1 = JSON.parse(sessionStorage.getItem('reg_part1') || "{}");
      const payload = {
        ...part1,
        height_cm: Number(document.getElementById('reg_height').value),
        weight_kg: Number(document.getElementById('reg_weight').value),
        experience: document.getElementById('reg_experience').value,
        goal: document.getElementById('reg_goal').value
      };

      // validación simple
      if (!payload.height_cm || !payload.weight_kg || !payload.experience || !payload.goal) {
        document.getElementById('register_msg2').textContent = "Completá todos los campos.";
        return;
      }

      try {
        // acá usamos la misma función register() de js/app.js
        await register(payload);
        sessionStorage.removeItem('reg_part1');
        alert('Usuario creado. Ahora iniciá sesión.');
        window.location.href = "login.html";
      } catch (e) {
        document.getElementById('register_msg2').textContent = e.message;
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>
</body>

</html>